(function(n){var t={init:function(i){return this.each(function(){var f=this,u=n(this),e=u.data("imgdata")||{},s={linkSelector:"li > a",toolbar:null,autoStartSlideshow:window.PorchLight.Preferences.SlideShowOn},r=n.extend(s,i),o=u.find("ul > li");u.find(r.linkSelector).each(function(t){n(this).data("index",t)}).on("click",function(i){return(i.preventDefault(),i.which==2||i.metaKey)?!0:(t.go.call(f,n(this).data("index")),!1)});e={mainImg:u.find(".mainImg"),images:o,toolbar:r.toolbar,progress:r.toolbar.find(".slideshowProgressBar"),ct:o.length,currentIndex:0,slideshowTimer:null,slideshowRunning:r.autoStartSlideshow},u.data("imgdata",e),r.toolbar!=null&&t._bindToolbarEvents.call(f),r.autoStartSlideshow&&t.startSlideshow.call(f)})},go:function(i){var e=this,o=n(this),r=o.data("imgdata"),u,f;r&&(i<0?i=r.ct-1:i>=r.ct&&(i=0),u=n(r.images[i]),r.currentIndex=i,r.mainImg.attr("src",u.find("img").attr("src")),r.images.find(".sel").removeClass("sel"),u.find("a").addClass("sel"),f=n(".thumbContainer").width(),n(".thumbContainer").stop().animate({scrollLeft:(i+1)*84-f/2-42},1e3,"easeOutExpo"),r.toolbar.find(".tbCount").text(i+1),r.slideshowRunning&&t.startSlideshow.call(e))},_bindToolbarEvents:function(){var i=this,u=n(this),r=u.data("imgdata");r.toolbar.on("click","button",function(u){u.preventDefault();var f=n(this);switch(f.data("action")){case"next":t.go.call(i,++r.currentIndex);break;case"prev":t.go.call(i,--r.currentIndex);break;case"slideshow":f.hasClass("icon-pause")?(t.stopSlideshow.call(i),f.removeClass("icon-pause").addClass("icon-play-2"),f.attr("data-original-title","Play slideshow")):f.hasClass("icon-play-2")&&(r.slideshowRunning=!0,t.startSlideshow.call(i),f.removeClass("icon-play-2").addClass("icon-pause"),f.attr("data-original-title","Pause slideshow")),public_setPreference({SlideShowOn:!window.PorchLight.Preferences.SlideShowOn});break;case"enhance":t.enhance.call(i)}})},startSlideshow:function(){var r=this,u=n(this),i=u.data("imgdata");clearTimeout(i.slideshowTimer),i.progress.stop().width(0).animate({width:"100%"},4999,"linear"),i.slideshowTimer=window.setTimeout(function(){t.go.call(r,++i.currentIndex)},5e3)},stopSlideshow:function(){var r=this,i=n(this),t=i.data("imgdata");t.slideshowRunning=!1,clearTimeout(t.slideshowTimer),t.progress.stop().width(0)},enhance:function(){var u=this,i=n(this),r=i.data("imgdata"),t=i.clone().attr("id",(new Date).getTime()).addClass("clonedGallery");t.find(".btnenhance, .hideOverflowBtn").remove(),t.find(".hideOverflow").removeClass("hideOverflow"),n.colorbox({html:t,width:790,className:"photoWidgetModal",onComplete:function(){t.photoWidget({toolbar:t.find(".photoWidgetControls"),autoStartSlideshow:r.slideshowRunning})},onCleanup:function(){t.photoWidget("stopSlideshow")},onClosed:function(){n.colorbox.remove()}})}};n.fn.photoWidget=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on jQuery.photoWidget");else return t.init.apply(this,arguments)}})(jQuery);